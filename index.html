<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Christian N. Kerr</title>

<style>
/* =========================================================
   CSS: TOKENS / BASE
========================================================= */
:root{
  --bg:#bfbfbf; --panel:#b7b7b7; --paper:#fff; --paper2:#f7f7f7; --ink:#000;
  --hi:#fff; --deep:#000; --accent:#ff7a00;
  --mono: ui-monospace, Menlo, Monaco, Consolas, monospace;
  --rail:220px; --gap:12px; --btn:64px;
  --stroke:2px; --pad:10px; --shadow:0 1px 0 rgba(0,0,0,.25);

  /* subtle scrollbar sizing */
  --sb:8px;
  --sbThumb:rgba(0,0,0,.18);
  --sbThumbHover:rgba(0,0,0,.28);
}

*{box-sizing:border-box}
html,body{height:100%}
[hidden]{ display:none !important; }
body{
  margin:0; font-family:var(--mono); color:var(--ink);
  background:
    repeating-linear-gradient(0deg,rgba(0,0,0,.22) 0 1px,transparent 1px 2px),
    repeating-linear-gradient(90deg,rgba(255,255,255,.18) 0 1px,transparent 1px 2px),
    repeating-linear-gradient(45deg,rgba(0,0,0,.12) 0 1px,transparent 1px 3px),
    var(--bg);
  overflow:auto;
}

@media (prefers-reduced-motion: reduce){
  *{ scroll-behavior:auto !important; }
}

/* =========================================================
   CSS: LAYOUT SHELL
========================================================= */
.frame{
  height:100svh;
  display:grid;
  grid-template-columns:var(--rail) 1fr;
  gap:18px;
  padding:
    calc(18px + env(safe-area-inset-top))
    calc(18px + env(safe-area-inset-right))
    calc(18px + env(safe-area-inset-bottom))
    calc(18px + env(safe-area-inset-left));
  align-items:start;
}

/* MOBILE / NARROW: sidebar becomes top bar */
@media (max-width:820px){
  .frame{
    grid-template-columns:1fr;
    grid-template-rows:auto 1fr;
    gap:12px;
  }
  aside.win{ position:relative; top:auto; }
}

.win{
  background:var(--panel);
  padding:var(--pad);
  border:var(--stroke) solid;
  border-color:var(--hi) var(--deep) var(--deep) var(--hi);
  box-shadow:var(--shadow);
}
aside.win{position:sticky;top:18px}

/* Stage never scrolls; each page box scrolls (prevents double scrollbars). */
.stage{
  height:100%;
  min-height:0;
  overflow:hidden;
  -webkit-overflow-scrolling:touch;
}

/* panels */
.panel{display:none; content-visibility:auto; contain-intrinsic-size:800px}
.panel.isActive{display:block; height:100%; content-visibility:visible}

/* =========================================================
   CSS: NAV + CLOCK
========================================================= */
.nameBtn{
  display:block; width:100%;
  text-align:center;
  font-weight:800; font-size:12px; letter-spacing:.08em;
  padding:8px;
  background:var(--paper);
  border:2px solid #000;
  cursor:pointer; user-select:none;
  margin-bottom:var(--gap);
  color:inherit;
  text-decoration:none;
}
.nameBtn.isActive{background:var(--accent)}

.controls{display:grid;justify-items:center;gap:var(--gap)}

.btns{
  display:grid;
  grid-template-columns: var(--btn);
  grid-auto-rows: var(--btn);
  gap:10px;
  justify-content:center;
}

.btn{
  width:var(--btn); height:var(--btn);
  display:grid; place-items:center;
  background:var(--paper2);
  border:2px solid;
  border-color:var(--hi) var(--deep) var(--deep) var(--hi);
  box-shadow:var(--shadow);
  cursor:pointer; user-select:none;
  color:inherit;
  text-decoration:none;
}
.btn:active{transform:translate(1px,1px)}
.glyph{font-size:32px;font-weight:900;line-height:1}
.btn.isActive{
  background:var(--accent);
  border-color:var(--deep) var(--hi) var(--hi) var(--deep);
}

/* Blog: standout by default, but use normal active orange when selected */
#linkNotes:not(.isActive){
  background:#FFF3A0;
}

/* TOP BAR state */
@media (max-width:820px){
  .btns{
    grid-template-columns: repeat(4, var(--btn));
    grid-auto-rows: var(--btn);
    gap:8px;
    justify-content:center;
  }
}

.clockBtn{
  width:100%;
  background:#cfe8ff;
  border:2px solid #000;
  padding:8px 10px;
  text-align:center;
  box-shadow:var(--shadow);
  cursor:pointer;
  user-select:none;
  font-family:inherit;
  color:#000;
}
.clockBtn:active{transform:translate(1px,1px)}
.clockLine{font-size:12px;font-weight:800;letter-spacing:.06em}

@media (max-width:820px){
  aside.win{ padding:8px; }
  .clockBtn{ padding:6px 8px; }
  .clockLine{ font-size:11px; }
}

/* =========================================================
   CSS: SUBTLE SCROLLBARS (reusable)
========================================================= */
.scrollbox{
  overflow:auto;
  overscroll-behavior:contain;
  -webkit-overflow-scrolling:touch;

  scrollbar-width:thin;
  scrollbar-color: var(--sbThumb) transparent;

  scrollbar-gutter: stable both-edges;
}
.scrollbox::-webkit-scrollbar{ width:var(--sb); height:var(--sb); }
.scrollbox::-webkit-scrollbar-track{ background:transparent; }
.scrollbox::-webkit-scrollbar-thumb{
  background:var(--sbThumb);
  border-radius:10px;
  border:3px solid transparent;
  background-clip: padding-box;
}
.scrollbox:hover::-webkit-scrollbar-thumb{ background:var(--sbThumbHover); }
.scrollbox::-webkit-scrollbar-corner{ background:transparent; }

/* =========================================================
   CSS: HOME (ART VIEWER)
========================================================= */
#p-home .wrap{
  width:100%;
  max-width:100%;
  margin:0;
  height:100%;
  display:flex;
  flex-direction:column;
  min-height:0;
}

/* Touch devices: allow native panning in both directions. */
#viewport{ touch-action: pan-x pan-y; }

/* Desktop: we handle drag-to-pan. */
@media (hover:hover) and (pointer:fine){
  #viewport{ touch-action:none; }
}

#viewport{
  width:100%;
  flex:1 1 auto;
  min-height:0;
  border:2px solid #000;
  background:transparent;
  outline:none;
  position:relative;
}
#viewport:focus-visible{ outline:2px solid #000; outline-offset:3px; }

#canvas{
  width: max(220%, 900px);
  height: max(220%, 900px);
  position:relative;
  background:transparent;
}
#canvas img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  pointer-events:none;
  user-select:none;
  -webkit-user-drag:none;
}

@media (hover:hover) and (pointer:fine){
  #viewport{ cursor:grab; }
  #viewport.isGrabbing{ cursor:grabbing; }
}

#homeOverlay{
  margin-top:10px;
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:10px;
}
#homeOverlay .pager{flex:0 0 auto}
#homeOverlay .caption{flex:1 1 auto; min-width:0}

.caption{
  max-width:420px;
  background:#fff;
  border:2px solid #000;
  padding:6px 8px;
  font-size:11px;
  line-height:1.2;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;

  /* button reset (caption is clickable) */
  cursor:pointer;
  font-family:inherit;
  text-align:left;
  appearance:none;
}
.caption:active{ transform:translate(1px,1px); }
.caption:focus{ outline:2px solid #000; outline-offset:2px; }
.pager{display:flex;gap:6px}
.pbtn{
  width:34px;height:28px;display:grid;place-items:center;
  background:var(--paper2);
  border:2px solid;
  border-color:var(--hi) var(--deep) var(--deep) var(--hi);
  box-shadow:var(--shadow);
  cursor:pointer; user-select:none;
  color:#000;
  font-family:inherit;
}
.pbtn:active{transform:translate(1px,1px)}

/* =========================================================
   CSS: CONTENT PAGES
========================================================= */
.list{
  width:100%;
  height:100%;
  margin:0;
  background:#fff;
  border:2px solid #000;
  padding:14px 14px 16px;
  font-size:13px;
  line-height:1.2;
  box-shadow:var(--shadow);

  display:flex;
  flex-direction:column;
  min-height:0;
}

.pageScroll{ flex:1 1 auto; min-height:0; }

.pageInner{
  width:max-content;
  min-width:100%;
  padding-right:18px;
  padding-bottom:14px;
}

.list h2{
  margin:0 0 8px;
  font-size:14px;
  letter-spacing:.08em;
}

.rule{
  height:2px;
  background:#000;
  margin:0 0 14px;
}
.spacer{height:14px}

.items{ margin-top:10px; width:max-content; min-width:100% }

#p-notes #items-notes.items{ margin-top:0; }


.item{
  padding:6px 0;
  border-top:1px solid rgba(0,0,0,.14);
  font-variant-numeric: tabular-nums;
}
.item:first-child{border-top:0}
.pathRow{display:flex;align-items:baseline;gap:6px;white-space:nowrap}
.prompt{opacity:.95}
.promptLine{display:flex;align-items:baseline;gap:0;white-space:nowrap}
.titleCell{white-space:nowrap}
.sep{opacity:.55;margin:0;}
.metaLine{white-space:nowrap;font-size:10px;opacity:.75;font-variant-numeric: tabular-nums}

.list a, .caption a{
  color:#1f4f8a;
  text-decoration:none;
  -webkit-tap-highlight-color: transparent;
}
.list a:visited, .caption a:visited{ color:#1f4f8a; }
.list a:focus, .caption a:focus{
  outline:2px solid #000;
  outline-offset:2px;
}

em{font-style:italic}
.q{ quotes: "“" "”" "‘" "’"; }
.q::before{ content: open-quote; }
.q::after{ content: close-quote; }

/* CONTACT: no scroll; wrap within the box */
#p-contact .list{ overflow:hidden; }
#p-contact p{ white-space:normal; overflow-wrap:anywhere; }

/* =========================================================
   CSS: BLOG — IN-WINDOW (no popup)
   - Single scroll surface (like other pages)
   - Horizontal list scroll with sticky LED column
   - Entry header (title/meta) reserves space so buttons never clip
========================================================= */
#p-notes #scroll-notes{ overflow:auto; }
#p-notes .blogPage{
  height:100%;
  display:flex;
  flex-direction:column;
  min-height:0;
}


#p-notes .blogBody{ flex:1 1 auto; min-height:0; display:flex; flex-direction:column; }
#p-notes #blogListWrap{ flex:1 1 auto; min-height:0; overflow:auto; }
#p-notes #blogView{ flex:1 1 auto; min-height:0; overflow:auto; }
#p-notes .blogContent{ flex:1 1 auto; min-height:0; }
#p-notes .pageInner.blogPage{ padding-bottom:0; }


/* Top row: BLOG + nav (no open button here) */
#p-notes .blogHdr{
  position:sticky;
  top:0;
  z-index:120;
  background:#fff;
  padding:0;
  overflow:visible;
}
#p-notes .blogHdr .rule{ margin:0 0 14px; }

@media (max-width:560px){
  #p-notes .blogHdrTop{ flex-wrap:wrap; gap:6px; }
  #p-notes .blogPath{ width:100%; white-space:normal; overflow:visible; text-overflow:clip; }
  #p-notes .blogBtns{ margin-left:auto; }
  #p-notes .notesMiniBtn{ min-width:44px; height:40px; }
}
#p-notes .blogHdrTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:nowrap;
  min-height:0;
  margin: 0 0 6px
}

#p-notes .blogPath{
  display:flex;
  align-items:baseline;
  gap:6px;
  min-width:0;
  font-size:14px;
  letter-spacing:.08em;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#p-notes .blogCrumb{
  font:inherit;
  color:inherit;
  background:transparent;
  border:1px solid transparent;
  padding:0 2px;
  margin:0;
}
#p-notes .blogCrumbHome{
  cursor:pointer;
  font-weight:800;
  text-transform:uppercase;
  letter-spacing:.08em;
}
#p-notes .blogCrumbHome:hover{
  background:#000;
  color:#fff;
  border-color:#000;
}
#p-notes .blogCrumbHome:active{ transform:translate(1px,1px); }
#p-notes .blogCrumbTail{
  font-size:11px;
  letter-spacing:.02em;
  opacity:.75;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  min-width:0;
}

#p-notes .blogBtns{
  display:flex;
  align-items:center;
  gap:6px;
  flex:0 0 auto;
  flex-wrap:nowrap;
  white-space:nowrap;
}

#p-notes .blogPath{ flex:1 1 auto; }
#p-notes .blogBtns{ margin-left:auto; }


/* Blog nav buttons: match TimeQuotes keycaps */
#p-notes .notesMiniBtn{
  width:54px;
  height:32px;
  background:#c0c0c0;
  border:2px solid;
  border-color:#ffffff #000000 #000000 #ffffff;
  box-shadow:inset 1px 1px 0 #dfdfdf, inset -1px -1px 0 #808080;
  cursor:pointer;
  font-family:inherit;
  font-weight:900;
  font-size:18px;
  line-height:1;
  padding:0;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color:transparent;
}
#blogList{font-weight:900;}

#p-notes .notesMiniBtn:active{
  border-color:#000000 #ffffff #ffffff #000000;
  box-shadow:inset 1px 1px 0 #808080, inset -1px -1px 0 #dfdfdf;
  transform:translate(1px,1px);
}
#p-notes .notesMiniBtn.isDim,
#p-notes .notesMiniBtn:disabled{
  opacity:.35;
  cursor:default;
}
#p-notes .notesMiniBtn.isDim:active,
#p-notes .notesMiniBtn:disabled:active{ transform:none; }

/* Blog sort buttons: active state */
#p-notes .notesMiniBtn.isOn{
  background:var(--accent);
  border-color:var(--deep) var(--hi) var(--hi) var(--deep);
}
/* Viewport below the rule: fixed (no clipping); list or entry manages its own content */
#p-notes .blogBody{
  flex:1;
  min-height:0;
  overflow:hidden;          /* prevents header/nav from being clipped by inner scroll */
  touch-action: pan-x pan-y;
  padding-right:2px;
  display:flex;
  flex-direction:column;
}

/* LIST scroll surface (both axes) */
#p-notes #blogListWrap{
  flex:1;
  min-height:0;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x pan-y;
  min-width:100%;
}
#p-notes .blogListInner{
  width:max-content;
  min-width:100%;
  padding-right:18px;
  padding-bottom:14px;
}

/* Each list row: sticky LED + single line (Title / Type / Date) */
#p-notes .noteRow{
  display:flex;
  align-items:baseline;
  gap:6px;
  padding:5px 0;
  border-top:1px solid rgba(0,0,0,.14);
  font-variant-numeric: tabular-nums;
  white-space:nowrap;
}
#p-notes .noteRow:first-child{ border-top:0; }

#p-notes .noteLedCell{
  position:sticky;
  left:0;
  z-index:4;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:flex-start;
}
#p-notes .noteLedCell::after{
  content:"";
  position:absolute;
  left:100%;
  top:0;
  bottom:0;
  width:10px;
  background:linear-gradient(90deg, rgba(255,255,255,1), rgba(255,255,255,0));
  pointer-events:none;
}

#p-notes .noteMain{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
}
#p-notes .noteMain .prompt{ opacity:.95; margin-right:0; }
#p-notes .noteMain a{ text-decoration:none; }
#p-notes .noteMain a:hover{ text-decoration:underline; }

#p-notes .noteSlash{
  opacity:.55;
  padding:0;
}
#p-notes .noteMeta{
  font-size:10px;
  opacity:.75;
  font-variant-numeric: tabular-nums;
}

/* Entry view occupies the same fixed viewport */
#p-notes #blogView{
  flex:1;
  min-height:0;
  display:flex;
  flex-direction:column;
  overflow:hidden; /* no vertical scrolling in entry view; media fits */
}
#p-notes .blogContent{
  flex:1;
  min-height:0;
  display:flex;
  overflow:hidden;
}
/* ENTRY view header under rule: title + open button */
#p-notes .blogEntryHdr{
  display:flex;
  align-items:center;
  justify-content:flex-start;
  gap:8px;
  margin:0 0 10px;
}
#p-notes .blogTitle{
  margin:0;
  font-weight:800;
  font-variant-numeric: tabular-nums;
  min-width:0;
  flex:1 1 auto;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#p-notes .blogTitleRow{ display:flex; align-items:center; justify-content:space-between; gap:10px; min-width:0; }
.blogTitleRow .blogTitle{ flex:1; min-width:0; white-space:normal; overflow-wrap:anywhere; }
#p-notes .blogTitleRow .blogTitle{ min-width:0; }
#p-notes .blogOpenBtn{
  display:flex;
  align-items:center;
  justify-content:center;
  height:32px;
  width:44px;
  padding:0;
  background:#cfcfcf;
  color:#000;
  border:2px solid;
  border-color:#ffffff #000000 #000000 #ffffff;
  box-shadow:inset 1px 1px 0 rgba(255,255,255,.25), inset -1px -1px 0 rgba(0,0,0,.35);
  cursor:pointer;
  align-self:center;
  font-family:inherit;
  font-weight:900;
  font-size:18px;
  line-height:1;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color: transparent;
}
#p-notes .blogOpenBtn:hover{ filter:brightness(1.08); }
#p-notes .blogOpenBtn:active{
  border-color:#000000 #ffffff #ffffff #000000;
  box-shadow:inset 1px 1px 0 rgba(0,0,0,.35), inset -1px -1px 0 rgba(255,255,255,.25);
  transform:translate(1px,1px);
}
#p-notes .blogOpenBtn:disabled{ opacity:.35; cursor:default; }
#p-notes .blogOpenBtn:disabled:active{ transform:none; }
#p-notes .blogOpenBtn:hover{ background:var(--accent); }
#p-notes .blogOpenBtn:active{ border-color:#000000 #ffffff #ffffff #000000; }
#p-notes .blogOpenBtn:active{ transform:translate(1px,1px); }
#p-notes .blogOpenBtn:disabled{ opacity:.35; cursor:default; }
#p-notes .blogOpenBtn:disabled:active{ transform:none; }

#p-notes .blogEntryMeta{
  font-size:10px;
  opacity:.75;
  margin:2px 0 10px;
}

/* Media containment (Blog viewer):
   Goal: ALWAYS fit media inside the window without clipping,
   while keeping a “floating on white” look (no heavy boxes).
   Sizing is driven by JS via --blogImgMaxH / --blogPdfMaxH / --blogVidMaxH.
*/
#p-notes{
  --blogImgMaxH: 520px;
  --blogPdfMaxH: 680px;
  --blogVidMaxH: 520px;
}

/* Blog page should not become width:max-content (that clips the right side on narrow view). */
#p-notes .pageInner{
  width:100%;
  min-width:0;
  padding-right:0;
}

/* Media wrap */
#p-notes .blogMediaFrame{
  width:100%;
  display:flex;
  align-items:flex-start;
  justify-content:flex-start; /* left aligned */
  background:transparent;
  border:0;
  box-shadow:none;
}

/* Make the media itself feel like it’s floating (shadow only). */
#p-notes .blogMediaFrame > img,
#p-notes .blogMediaFrame > video,
#p-notes .blogMediaFrame > iframe,
#p-notes .blogMediaFrame > embed{
  display:block;
  max-width:100%;
  border:0;
  box-shadow:var(--shadow);
  background:#fff;
}

/* Images: never clip; constrain by BOTH width and available height */
#p-notes .blogMediaFrame > img{
  background:transparent;
  width:auto;
  height:auto;
  max-height: var(--blogImgMaxH);
  object-fit:contain;
}

/* Direct video files */
#p-notes .blogMediaFrame > video{
  width:100%;
  height:auto;
  max-height: var(--blogVidMaxH);
  background:#000;
}

/* Iframes */
#p-notes .blogMediaFrame > iframe{
  width:100%;
  border:0;
  background:#fff;
}

/* YouTube / iframe video: keep 16:9, but never exceed height budget */
#p-notes #blogView.isVideo .blogMediaFrame > iframe{
  aspect-ratio:16 / 9;
  height:auto;
  max-height: var(--blogVidMaxH);
}

/* PDF: full-width reading viewport with a small paper margin */
#p-notes #blogView.isPdf .blogMediaFrame{
  flex:1;
  min-height:0;
  padding:8px;              /* small paper margin */
  box-sizing:border-box;
}

#p-notes #blogView.isPdf .blogMediaFrame{
  height: var(--blogPdfMaxH);
  max-height: var(--blogPdfMaxH);
}

#p-notes #blogView.isPdf .blogMediaFrame > embed{
  width:100%;
  height:100%;              /* fill the viewport height */
  min-height: var(--blogPdfMaxH);
  max-width:none;
  display:block;
  box-shadow:none;          /* remove “boxed” look */
  background:#fff;
}

/* HTML: iframe uses the PDF height (readable) */
#p-notes #blogView.isHtml .blogMediaFrame > iframe{
  height: var(--blogPdfMaxH);
}

/* ===== BLOG v5c: list matches Clips/Research ===== */
#p-notes .noteItem{ padding:6px 0; }
#p-notes .noteItem .pathRow{ gap:0; }
#p-notes .noteItem .sep{ margin:0 6px; opacity:.9; }
#p-notes .noteItem .metaLine{ opacity:.75; font-size:11px; }

/* Sticky LED while horizontal scrolling the scrollbox */
#p-notes .noteLedCell{
  position:sticky;
  left:0;
  z-index:5;
  display:inline-flex;
  align-items:center;
  justify-content:flex-start;
  background:#fff;
  padding-right:6px;
}
#p-notes .noteLedCell::after{
  content:"";
  position:absolute;
  left:100%;
  top:0;
  bottom:0;
  width:10px;
  background:linear-gradient(90deg, rgba(255,255,255,1), rgba(255,255,255,0));
  pointer-events:none;
}

/* ===== BLOG v5c: lock header controls above rule ===== */
#p-notes .blogHdr{
  position:sticky;
  top:0;
  z-index:120;
  background:#fff;
}
#p-notes .blogHdrTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:nowrap;
  padding:0;
}
#p-notes .blogPath{
  min-width:0;
  overflow:hidden;
  white-space:nowrap;
  text-overflow:ellipsis;
}
#p-notes .blogBtns{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap:nowrap;
}
#p-notes .blogSortIcons{ display:flex; gap:6px; align-items:center; }

/* ===== BLOG v5c: entry media always fits remaining viewport (no crop) ===== */
#p-notes #blogView{ overflow:hidden; }
#p-notes .blogContent{
  flex:1;
  min-height:0;
  display:flex;
  overflow:hidden; /* no scroll; content shrinks */
}
#p-notes .blogMediaFrame{
  flex:1;
  min-height:0;
  width:100%;
  display:flex;
  align-items:stretch;
  justify-content:flex-start; /* left aligned */
  overflow:hidden; /* prevent accidental crop via scroll area */
  padding:0;
}
/* images/videos: use max constraints (NOT width/height 100%) */
#p-notes .blogMediaFrame img,
#p-notes .blogMediaFrame video{
  display:block;
  width:100%;
  height:100%;
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  object-position:left center;
}
/* iframes/embeds should fill the frame */
#p-notes .blogMediaFrame iframe,
#p-notes .blogMediaFrame embed{
  width:100%;
  height:100%;
}

/* Caption: blends with the window */
#p-notes #blogCaption{
  margin-top:10px;
  background:var(--paper2);
  color:rgba(0,0,0,.75);
  border:2px solid;
  border-color:var(--hi) var(--deep) var(--deep) var(--hi);
  box-shadow:var(--shadow);
  padding:7px 9px;
  font-size:10px;
  line-height:1.25;
  white-space:normal;
  overflow-wrap:anywhere;
  max-height:140px;
  overflow:auto;
}



/* === BLOG v5e FIXES ===
   1) ensure header buttons never clip
   2) media never crops in narrow view
   3) captions wrap naturally (no forced scroll)
*/
#p-notes .blogHdrTop{ min-height:48px; }
#p-notes .blogBtns{ align-items:center; }
#p-notes .notesMiniBtn{ height:26px; line-height:1; }

#p-notes .blogContent{ overflow:hidden; }
#p-notes .blogMediaFrame{ overflow:hidden; }
#p-notes .blogMediaFrame img,
#p-notes .blogMediaFrame video{
  width:100%;
  height:100%;
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  object-position:left center;
}

/* keep photos floating */
#p-notes .blogMediaFrame.isImgFrame{
  border:0;
  box-shadow:none;
  background:transparent;
}

/* caption: wrap, no scrolling box unless truly necessary */
#p-notes #blogCaption{
  max-height:none;
  overflow:visible;
  white-space:normal;
}


/* =========================================================
   CSS: BLOG LED (colors)
========================================================= */
.led-zine{ background:#990066; }
.led-video{ background:#FF6600; }
.led-photo{ background:#fdfb8c; }
.led-pdf{ background:#ffffff; }
.led-article{ background:#669900; }
.led-other{ background:#777; }

/* =========================================================
   BLOG v5J: STABLE MEDIA FIT + STICKY CONTROLS
   - No cropping for horizontal OR vertical photos
   - Header controls never disappear (independent of media)
   - PDFs/iframes/videos float (no heavy frames)
   - Captions wrap
========================================================= */

/* Keep the blog header controls pinned and unclippable */
#p-notes .blogHdr{
  position:sticky;
  top:0;
  z-index:200;
  background:#fff;
  overflow:visible;
}
#p-notes .blogHdrTop{
  min-height:46px;
  padding:2px 0 6px;
  flex-wrap:nowrap;
  align-items:center;
}
#p-notes .blogBtns{
  display:flex;
  gap:10px;
  flex-wrap:nowrap;
  align-items:center;
}
#p-notes .blogBtns button{ line-height:1; }

/* Entry view becomes a true viewport: header + media + caption */
#p-notes #blogBody{
  display:flex;
  flex-direction:column;
  min-height:0;
}
#p-notes #blogView{
  display:flex;
  flex-direction:column;
  flex:1 1 auto;
  min-height:0;
}
#p-notes .blogEntryRow{
  flex:0 0 auto;
}
#p-notes .blogContent{
  flex:1 1 auto;
  min-height:0;
  overflow:hidden; /* media must fit; no cropping */
  display:flex;
  flex-direction:column;
}

/* Media frame fills available space; left-aligned */
#p-notes .blogMediaFrame{
  flex:1 1 auto;
  min-height:0;
  height:100%;
  width:100%;
  display:flex;
  align-items:flex-start;
  justify-content:flex-start;
  background:transparent;
  border:0;
  box-shadow:none;
  overflow:hidden;
}

/* All media types: fill frame, contain without cropping */
#p-notes .blogMediaFrame > img,
#p-notes .blogMediaFrame > video,
#p-notes .blogMediaFrame > iframe,
#p-notes .blogMediaFrame > embed{
  width:100%;
  height:100%;
  max-width:100%;
  max-height:100%;
  display:block;
  border:0;
  box-shadow:none; /* floating look */
  background:transparent;
}

/* Images: contain + left align */
#p-notes .blogMediaFrame > img{
  object-fit:contain;
  object-position:left top;
}

/* Video files: contain within frame */
#p-notes .blogMediaFrame > video{
  object-fit:contain;
  background:transparent;
}

/* Iframes/PDFs: fill frame */
#p-notes .blogMediaFrame > iframe,
#p-notes .blogMediaFrame > embed{
  background:#fff;
}

/* Captions: wrap, no forced scrolling */
#p-notes #blogCaption{
  white-space:normal;
  overflow:visible;
  max-height:none;
}



/* =========================================================
   BLOG v5K: PDF fit + caption nestle
   - PDFs/HTML fill the remaining viewport (no cut-off)
   - Caption sits tight under media
========================================================= */
#p-notes #blogView.isPdf .blogMediaFrame{ overflow:auto !important; }
#p-notes #blogView.isPdf .blogMediaFrame > embed{ height:100% !important; }
#p-notes #blogView.isHtml .blogMediaFrame{ overflow:auto !important; }
#p-notes #blogView.isHtml .blogMediaFrame > iframe{ height:100% !important; }

/* Nestle caption close to media */
#p-notes .blogMediaFrame > img{ object-position:left bottom; }
#p-notes #blogCaption{ margin-top:6px !important; padding:6px 8px !important; }
/* Tighten vertical whitespace in entry view */
#p-notes .blogEntryRow{ margin:8px 0 8px; }
#p-notes .blogContent{ margin:0; }

/* =========================================================
   CSS: DIALOGS (TimeQuotes + Notes + About)
========================================================= */
#timeDialog, #noteDialog, #aboutDialog{
  border:0;
  padding:0;
  background:transparent;
}
#timeDialog::backdrop, #noteDialog::backdrop, #aboutDialog::backdrop{
  background:rgba(0,0,0,.35);
}
#timeDialog[open], #noteDialog[open], #aboutDialog[open]{
  position:fixed;
  inset:0;
  margin:auto;
  width:min(1200px, 92vw);
  max-height:92vh;
}

.tqModal{
  background:#c0c0c0;
  border:2px solid;
  border-color:#ffffff #000000 #000000 #ffffff;
  box-shadow:var(--shadow);
  padding:0;
  overflow:hidden;
  max-height:92vh;
}
.tqQuoteBox{
  margin:12px;
  padding:16px 18px;
  background:#fff;
  border:2px solid #000;
  box-shadow:none;
}
.tqBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  margin:0;
  padding:4px 6px;
  background:linear-gradient(90deg,#000080,#1084d0) !important;
  border-bottom:2px solid #000;
}

.tqTitle{
  font-weight:800;
  font-size:13px;
  letter-spacing:.02em;
  color:#fff;
  user-select:none;
}
.tqIdx{
  margin-left:18px;
  font-weight:300;
  font-size:11px;
  color:#fff;
  opacity:.7;
}
.tqNav{display:flex;align-items:center;gap:10px}
.tqNavBtn{
  width:34px;
  height:28px;
  background:#c0c0c0;
  border:2px solid;
  border-color:#ffffff #000000 #000000 #ffffff;
  box-shadow:none;
  cursor:pointer;
  font-family:inherit;
  font-weight:800;
  padding:0;
}
.tqCloseBtn{
  width:26px;
  height:26px;
  background:#c0c0c0;
  border:2px solid;
  border-color:#ffffff #000000 #000000 #ffffff;
  cursor:pointer;
  font-size:16px;
  line-height:1;
  padding:0;
  display:grid;
  place-items:center;
}

.tqNavBtn:active, .tqCloseBtn:active{
  border-color:#000000 #ffffff #ffffff #000000;
  transform:none;
}

.tqNavBtn[disabled]{ opacity:.45; cursor:default; }
.tqNavBtn[disabled]:active{ transform:none; }

/* =========================================================
   ABOUT: mobile layout polish
========================================================= */
@media (max-width: 600px){
  #aboutDialog[open]{
    width:96vw;
    max-height:94svh;
  }
  #aboutDialog .tqModal{
    padding:10px;
    max-height:94svh;
  }
  #aboutDialog .tqBar{
    gap:10px;
  }
  #aboutDialog .tqTitle{
    font-size:13px;
  }
  #aboutDialog .tqQuoteBox{
    padding:12px 12px;
  }
}

/* NOTE MODAL HEADER: prev/led/next on the left */
.noteBar{ justify-content:flex-start; }
.noteNavLeft{
  display:flex;
  align-items:center;
  gap:10px;
  flex:0 0 auto;
}
#noteDialog .noteNavLeft .led{
  width:12px;
  height:12px;
  display:inline-block;
  margin:0;
  border:1px solid #000;
  box-shadow:var(--shadow);
}

.noteCaption{
  border-top:2px solid #000;
  background:#000;
  color:#9a9a9a;
  padding:8px 10px;
  font-size:10px;
  line-height:1.25;
  white-space:normal;
  overflow-wrap:anywhere;
}

.tqQuote{
  font-size:12px;
  line-height:1.15;
  font-family:var(--mono);
  white-space:pre-wrap;
}
.tqMeta{
  margin-top:12px;
  font-size:12px;
  font-family:var(--mono);
  color:#000;
}

/* notes iframe container */
.noteFrameWrap{
  border:2px solid #000;
  background:#fff;
  overflow:auto;
}
#noteImg{ display:block; background:#fff; border:0; }
#notePdf, #noteFrame{
  width:100%;
  height:min(78vh, 760px);
  border:0;
  display:block;
  background:#fff;
}

@media (max-width:420px){
  :root{--btn:48px}
  .glyph{font-size:28px}
  .caption{max-width:70%;font-size:10px}
  .tqTitle{font-size:18px}
  .tqNavBtn{width:66px;height:52px}
  .tqCloseBtn{width:110px;height:52px}
  .tqQuote, .tqMeta{font-size:16px}
  #noteFrame{ height:min(78vh, 680px); }
}

/* ASCII in About module */
#aboutModule pre.ascii,
.aboutmodule pre.ascii,
.aboutModule pre.ascii{
  font-family: var(--mono, ui-monospace, Menlo, Monaco, Consolas, monospace);
  font-size: 8px;
  line-height: 1.0;
  white-space: pre;
  margin: 0;
  overflow: hidden;
}

#aboutText pre.ascii{
  background:#000;
  color:#ddd;
  padding:10px;
  margin:0;
  white-space:pre;
  overflow:auto;
  max-height:60vh;
}

#aboutModule pre.ascii.ascii-color span{ white-space: pre; }

/* =========================================================
   MOBILE: WINDOW MANAGER DIALOGS (floating, consistent)
========================================================= */
body.modalOpen{ overflow:hidden; }

@media (max-width:700px){
  #timeDialog[open], #noteDialog[open], #aboutDialog[open]{
    position:fixed;
    inset:0;
    margin:0;
    width:100vw;
    height:100svh;
    max-height:none;
    padding:
      calc(14px + env(safe-area-inset-top))
      calc(14px + env(safe-area-inset-right))
      calc(14px + env(safe-area-inset-bottom))
      calc(14px + env(safe-area-inset-left));
    display:flex;
    align-items:center;
    justify-content:center;
  }

  #timeDialog .tqModal, #noteDialog .tqModal, #aboutDialog .tqModal{
    position:relative;
    left:auto;
    top:auto;
    transform:none;
    margin:0;
    margin-top:-3svh;
    width:min(520px, 94vw);
    max-height:82svh;

    padding:0;
    overflow:hidden;
  }

  #timeDialog .tqTitle, #aboutDialog .tqTitle, #noteDialog .tqTitle{
    font-size:12px;
    letter-spacing:.06em;
  }
  #timeDialog .tqIdx, #aboutDialog .tqIdx{
    font-size:10px;
    opacity:.75;
    margin-left:10px;
  }
  #timeDialog .tqBar, #aboutDialog .tqBar, #noteDialog .tqBar{
    gap:10px;
    }

  .tqNavBtn, .tqCloseBtn{
    width:40px;
    height:34px;
    padding:0;
    background:#c0c0c0;
    border:2px solid;
    border-color:#ffffff #000000 #000000 #ffffff;
    box-shadow:none;
    cursor:pointer;
    font-family:inherit;
    font-weight:900;
    display:grid;
    place-items:center;
    color:#000;
    font-size:18px;
    line-height:1;
    -webkit-tap-highlight-color: transparent;
  }
  .tqNavBtn:active, .tqCloseBtn:active{
    border-color:#000000 #ffffff #ffffff #000000;
  }
#timeDialog .tqQuoteBox,
  #aboutDialog .tqQuoteBox,
  #noteDialog .noteFrameWrap{
    overflow:auto;
    -webkit-overflow-scrolling:touch;
    max-height:calc(82svh - 64px);
  }

  #timeDialog .tqQuote, #aboutDialog .tqQuote{
    font-size:12px;
    line-height:1.25;
  }
  #timeDialog .tqMeta{
    font-size:11px;
    line-height:1.25;
  }

  #aboutDialog #aboutText.tqQuote{
    font-size:12px;
    line-height:1.25;
  }
  #aboutDialog .tqQuoteBox{ padding:12px; }

  #notePdf, #noteFrame{
    height:min(62svh, 520px);
  }

  #noteDialog .noteFrameWrap.isImg{
    background:#000;
    display:grid;
    grid-template-rows:auto auto;
    gap:0;
  }
  #noteDialog .noteFrameWrap.isImg #noteImg{
    width:100%;
    height:100%;
    object-fit:contain;
    background:#000;
    margin:0;
    display:block;
  }
  #noteDialog .noteFrameWrap.isImg.isFill #noteImg{
    object-fit:cover;
  }

  .noteCaption{
    font-size:10px;
    line-height:1.25;
  }

  .notePdfMobile{
    padding:14px 12px;
  }
}

/* Keep consistent YouTube sizing (desktop + mobile) */
.noteFrameWrap.isVideo{
  background:#000;
}
.noteFrameWrap.isVideo #noteFrame{
  width:100%;
  aspect-ratio:16 / 9;
  height:auto;
  max-height:min(70vh, 720px);
  background:#000;
}

/* =========================================================
   PDF MOBILE PANEL: icon button (terminal-clean)
========================================================= */
.notePdfMobile{
  border:2px solid #000;
  background:#fff;
  padding:16px 14px;
  display:grid;
  grid-template-columns:1fr auto; /* title left, icon right */
  align-items:center;
  gap:10px;
}

.notePdfMobile .pdfTitle{
  font-weight:900;
  font-size:12px;
  line-height:1.1;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}

/* hit area (44) with a small keycap face inside */
.noteOpenBtn{
  width:44px;
  height:44px;
  padding:0;
  background:transparent;
  border:0;
  box-shadow:none;
  cursor:pointer;
  user-select:none;
  position:relative;
  display:grid;
  place-items:center;
  font-family:var(--mono);
  color:#000;
  -webkit-tap-highlight-color: transparent;
  isolation:isolate;
}

.noteOpenBtn::before{
  content:"";
  position:absolute;
  left:50%;
  top:50%;
  width:34px;
  height:24px;
  transform:translate(-50%,-50%);
  background:#c4c4c4;
  border:1px solid #000;
  box-shadow:var(--shadow);
  z-index:-1;
}

.noteOpenBtn:active::before{
  transform:translate(calc(-50% + 1px), calc(-50% + 1px));
}

.noteOpenBtn .ico{
  display:block;
  font-size:16px;
  line-height:1;
  font-weight:900;
}

/* ===== v5c: About + TimeQuotes dialogs more Win95 grey ===== */
#modalOverlay{ background:rgba(0,0,0,.25); }
.modalWin, .modal, #modal{
  background:var(--panel);
}
.modalWin .modalHead, .modal .modalHead, #modal .modalHead{
  background:#c9c9c9;
  border-bottom:1px solid #000;
}
.modalWin .modalBody, .modal .modalBody, #modal .modalBody{
  background:var(--paper);
}
.modalWin, .modal, #modal{
  border:2px solid #000;
  box-shadow:var(--shadow);
}


/* ===== Win95 greying for About + TimeQuotes dialogs ===== */
/* =========================================================
   BLOG v5f HOTFIX: header never clips, media never crops
   - simplify sizing: media frame fills the viewport
   - PDFs default to page-width (see JS #view=FitH)
========================================================= */
#p-notes .blogHdr{ background:#fff; overflow:visible; }
#p-notes .blogBtns .notesMiniBtn{ line-height:1; }

#p-notes .blogBody{
  height:100%;
  min-height:0;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

#p-notes #blogListWrap{
  flex:1;
  min-height:0;
  overflow:auto;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior:contain;
}
#p-notes #blogListWrap .blogListInner{ min-width:max-content; }

#p-notes #blogView{
  flex:1;
  min-height:0;
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

/* Entry viewport: stretch media to available space */
#p-notes .blogContent{
  flex:1;
  min-height:0;
  overflow:hidden;
  display:flex;
  align-items:stretch;
  justify-content:flex-start;
  padding:0;
  background:#fff;
}
#p-notes .blogContent .blogMediaFrame{
  flex:1;
  min-height:0;
  width:100%;
  padding:0;
  overflow:hidden;
}
#p-notes .blogContent .blogMediaFrame > img,
#p-notes .blogContent .blogMediaFrame > video{
  width:100%;
  height:100%;
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  object-position:left center;
  display:block;
}
#p-notes .blogContent .blogMediaFrame > iframe,
#p-notes .blogContent .blogMediaFrame > embed{
  width:100%;
  height:100%;
  display:block;
}

/* PDF/HTML: allow inner scrolling when needed, but keep full-width */
#p-notes #blogView.isPdf .blogMediaFrame,
#p-notes #blogView.isHtml .blogMediaFrame{
  overflow:auto !important;
}

#p-notes #blogCaption, #p-notes #blogCaption2{
  white-space:normal !important;
  overflow-wrap:anywhere;
  word-break:break-word;
}
</style>
</head>

<body>
<div class="frame" id="root">
  <aside class="win" aria-label="Sidebar">
    <a class="nameBtn" id="linkHomeTop" href="#/home" data-route="home" title="Home" aria-label="Home">Christian N. Kerr</a>

    <div class="controls">
      <div class="btns" aria-label="Navigation">
        <a class="btn" id="linkNotes" href="#/notes" data-route="notes" title="Blog" aria-label="Blog"><div class="glyph">博</div></a>
        <a class="btn" id="linkWriting"  href="#/writing"  data-route="writing"  title="Clips"  aria-label="Clips"><div class="glyph">刊</div></a>
        <a class="btn" id="linkResearch" href="#/research" data-route="research" title="Research" aria-label="Research"><div class="glyph">研</div></a>
        <a class="btn" id="linkContact"  href="#/contact"  data-route="contact"  title="Contact" aria-label="Contact"><div class="glyph">联</div></a>
      </div>

      <button class="clockBtn" id="clockBtn" type="button" aria-label="Current date and time">
        <div class="clockLine" id="clockStamp">—</div>
      </button>
    </div>
  </aside>

  <main class="stage" id="stage" aria-label="Stage">
    <!-- HOME -->
    <section class="panel" id="p-home">
      <div class="win wrap" id="homeWrap">
        <div class="viewport scrollbox" id="viewport" tabindex="0" aria-label="Artwork viewer (drag or click to pan)">
          <div class="canvas" id="canvas">
            <img id="hero" src="" alt="" draggable="false" decoding="async" fetchpriority="high">
          </div>
        </div>

        <div class="overlayRow" id="homeOverlay" aria-label="Image controls">
          <div class="pager" aria-label="Slide navigation">
            <button class="pbtn" id="prev" type="button" aria-label="Previous image" title="Previous">◄</button>
            <button class="pbtn" id="next" type="button" aria-label="Next image" title="Next">►</button>
          </div>
          <button class="caption" id="caption" type="button" aria-label="Open current slide in new tab" title="Open slide in new tab">—</button>
        </div>
      </div>
    </section>

    <!-- CLIPS -->
    <section class="panel" id="p-writing">
      <div class="list">
        <div class="pageScroll scrollbox" id="scroll-writing">
          <div class="pageInner">
            <h2>CLIPS</h2>
            <div class="rule"></div>
            <div class="items" id="items-writing" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- RESEARCH -->
    <section class="panel" id="p-research">
      <div class="list">
        <div class="pageScroll scrollbox" id="scroll-researchAll">
          <div class="pageInner">
            <h2>RESEARCH</h2>
            <div class="rule"></div>
            <div class="items" id="items-research" aria-live="polite"></div>

            <div class="spacer"></div>

            <h2>FACT-CHECKING</h2>
            <div class="rule"></div>
            <div class="items" id="items-factChecking" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- BLOG -->
    <section class="panel" id="p-notes">
      <div class="list">
        <!-- outer box stays fixed; only inner below rule scrolls -->
        <div class="pageScroll scrollbox" id="scroll-notes">
          <div class="pageInner blogPage">
            
<div class="blogHdr" role="navigation" aria-label="Blog navigation">
              <div class="blogHdrTop">
                <div class="blogPath">
                <button id="blogHome" class="blogCrumb blogCrumbHome" type="button">blog</button>
                <span id="blogCrumbTail" class="blogCrumbTail" aria-hidden="true"></span>
              </div>

                <div class="blogBtns" aria-label="Blog controls">
                <div id="blogSort" class="blogSortIcons" aria-label="Blog sorting">
                  <button id="blogSortDate" class="notesMiniBtn blogSortIcon" type="button" aria-label="Sort by date" title="Sort by date">◷</button>
                  <button id="blogSortType" class="notesMiniBtn blogSortIcon" type="button" aria-label="Sort by type" title="Sort by type">≣</button>
                </div>

                <button id="blogPrev" class="notesMiniBtn blogNavBtn" type="button" aria-label="Previous entry">◄</button>
                <button id="blogNext" class="notesMiniBtn blogNavBtn" type="button" aria-label="Next entry">►</button>
                <button id="blogList" class="notesMiniBtn blogNavBtn" type="button" aria-label="Back to list" title="Back to list">↩</button>
              </div>

              </div>
              <div class="rule"></div>
            </div>

            <div class="blogBody" id="blogBody">
              <div id="blogListWrap"><div class="blogListInner"><div class="items" id="items-notes" aria-live="polite"></div></div></div>

              <div id="blogView" hidden>
                <div class="blogEntryHdr">
                  <div class="blogTitleRow">
                    <div class="blogTitle" id="blogTitle"></div>
                    <button id="blogOpen2" class="blogOpenBtn" type="button" aria-label="Open media in new tab" title="Open in new tab">⧉</button>
                  </div>
                </div>
<div class="blogContent" id="blogContent"></div>
                <div id="blogCaption" hidden></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

<!-- CONTACT -->
    <section class="panel" id="p-contact">
      <div class="list">
        <div class="pageScroll scrollbox">
          <div class="pageInner">
            <h2>CONTACT</h2>
            <div class="rule"></div>
            <p>
              Location: Brooklyn, New York, USA<br>
              Email: <a href="mailto:christian.n.kerr@gmail.com">christian.n.kerr@gmail.com</a><br>
              Socials:
              <a href="https://www.youtube.com/@CNKERR..." target="_blank" rel="noopener">YouTube</a>,
              <a href="https://x.com/cnkerr" target="_blank" rel="noopener">X</a>,
              <a href="https://www.instagram.com/cnkerr" target="_blank" rel="noopener">Instagram</a><br>
              Resumé: <a href="assets/kerr_christian_cv.pdf" target="_blank" rel="noopener">kerr_christian_cv</a>
            </p>
            <p class="quote" style="color:#838383; font-size:8px; line-height:1.25;">
              "I celebrate myself, and sing myself,<br>And what I assume you shall assume,<br>For every atom belonging to me as good belongs to you." <br>—WW
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- TIMEQUOTES dialog -->
<dialog id="timeDialog" aria-label="Time quotes">
  <div class="tqModal">
    <div class="tqBar">
      <div class="tqTitle">
        Time? <span class="tqIdx" id="timeIdx">00/00</span>
      </div>
      <div class="tqNav">
        <button class="tqNavBtn" id="timePrev" type="button" aria-label="Previous quote">◄</button>
        <button class="tqNavBtn" id="timeNext" type="button" aria-label="Next quote">►</button>
        <button class="tqCloseBtn" id="timeClose" type="button" aria-label="Close">x</button>
      </div>
    </div>

    <div class="tqQuoteBox" aria-live="polite">
      <div class="tqQuote" id="timeQuoteText">—</div>
      <div class="tqMeta" id="timeQuoteMeta">—</div>
    </div>
  </div>
</dialog>

<!-- ABOUT dialog -->
<dialog id="aboutDialog" aria-label="About this site">
  <div class="tqModal">
    <div class="tqBar">
      <div class="tqTitle" id="aboutTitle"></div>

      <div class="tqNav">
        <button class="tqNavBtn" id="aboutPrev" type="button" aria-label="Previous slide">◄</button>
        <button class="tqNavBtn" id="aboutNext" type="button" aria-label="Next slide">►</button>
        <button class="tqCloseBtn" id="aboutClose" type="button" aria-label="Close">x</button>
      </div>
    </div>

    <div class="tqQuoteBox" aria-live="polite">
      <div class="tqQuote" id="aboutText">—</div>
    </div>
  </div>
</dialog>

<!-- NOTES dialog (kept for legacy + deep links; blog page is in-window now) -->
<dialog id="noteDialog" aria-label="Note">
  <div class="tqModal">
    <div class="tqBar noteBar">
      <div class="noteNavLeft" aria-label="Blog navigation">
        <button class="tqNavBtn" id="notePrev" type="button" aria-label="Previous">&lt;</button>
        <span id="noteTypeLed" class="led led-other" aria-hidden="true"></span>
        <button class="tqNavBtn" id="noteNext" type="button" aria-label="Next">&gt;</button>
      </div>

      <div class="tqNav noteNavRight">
        <button class="tqCloseBtn" id="notePop" type="button" aria-label="Open in new tab">❒</button>
        <button class="tqCloseBtn" id="noteClose" type="button" aria-label="Close">x</button>
      </div>
    </div>

    <div class="noteFrameWrap" aria-live="polite">
      <img id="noteImg" alt="" hidden>

      <iframe
        id="noteFrame"
        title="Note"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
        referrerpolicy="strict-origin-when-cross-origin"
      ></iframe>

      <embed id="notePdf" type="application/pdf" hidden>

      <div id="notePdfMobile" class="notePdfMobile" hidden>
        <div class="pdfTitle" id="notePdfMobileTitle">PDF</div>
        <button class="noteOpenBtn" id="notePdfMobileBtn" type="button"
                aria-label="Open PDF in new tab" title="Open PDF">
          <span class="ico" aria-hidden="true">⧉</span>
        </button>
      </div>

      <div id="noteCaption" class="noteCaption" hidden></div>
    </div>
  </div>
</dialog>

<script>
/* =========================================================
   JS: BOOTSTRAP (loads data.js then starts)
========================================================= */
(function loadDataThenBoot(){
  function boot(){
    var $ = function(id){ return document.getElementById(id); };

    function esc(s){
      return String(s == null ? "" : s).replace(/[&<>"']/g, function(m){
        return ({ "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;" })[m];
      });
    }

    function normDashText(s){
      // Normalize dash separators (en/em) to include surrounding spaces, without touching hyphenated words.
      return String(s == null ? "" : s).replace(/\s*[–—]\s*/g, " – ");
    }

    // -------------------------------------------------------
    // JS: DATA (safe fallback)
    // -------------------------------------------------------
    var DATA = (window.DATA_REMOTE && typeof window.DATA_REMOTE === "object")
      ? window.DATA_REMOTE
      : { slides:[], writing:[], research:[], factChecking:[], timeQuotes:[], notes:[], aboutSlides: [] };

    function ensureArrayKey(obj, key){
      if (!obj || !Array.isArray(obj[key])) obj[key] = [];
    }
    ensureArrayKey(DATA, "slides");
    ensureArrayKey(DATA, "writing");
    ensureArrayKey(DATA, "research");
    ensureArrayKey(DATA, "factChecking");
    ensureArrayKey(DATA, "timeQuotes");
    ensureArrayKey(DATA, "notes");
    ensureArrayKey(DATA, "aboutSlides");

    var prefersReducedMotion = !!(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches);

    function isCoarsePointer(){
      return !!(window.matchMedia && window.matchMedia("(pointer: coarse)").matches);
    }
    function isMobileDialog(){
      return !!(window.matchMedia && window.matchMedia("(max-width:700px)").matches) || isCoarsePointer();
    }
    function setBodyModalOpen(on){
      document.body.classList.toggle("modalOpen", !!on);
    }

    // -------------------------------------------------------
    // JS: HOME VIEWER PAN
    // -------------------------------------------------------
    var viewport = $("viewport");
    var canvas = $("canvas");
    var hero = $("hero");

    function isHomeActive(){
      var p = $("p-home");
      return !!(p && p.classList.contains("isActive"));
    }

    function panCenter(){
      if (!viewport || !canvas) return;
      var maxX = Math.max(0, canvas.scrollWidth  - viewport.clientWidth);
      var maxY = Math.max(0, canvas.scrollHeight - viewport.clientHeight);
      viewport.scrollTo({ left: maxX * 0.5, top: maxY * 0.5, behavior:(prefersReducedMotion?"auto":"smooth") });
    }

    /* Keep the huge pan-canvas feel on mobile, but prevent “permanent crop”:
       resize the canvas to the slide’s aspect ratio (bigger than viewport in both axes). */
    function setCanvasForSlide(){
      if (!viewport || !canvas || !hero) return;
      if (!hero.naturalWidth || !hero.naturalHeight) return;

      var vw = viewport.clientWidth || 0;
      var vh = viewport.clientHeight || 0;
      if (!vw || !vh) return;

      var r = hero.naturalWidth / hero.naturalHeight;

      // Drive by the larger of (2.2x viewport) and 900px, then ensure both axes are “huge”.
      var targetW = Math.max(Math.floor(vw * 2.2), 900);
      var targetH = Math.floor(targetW / r);

      var minHugeH = Math.max(Math.floor(vh * 2.2), 900);
      if (targetH < minHugeH){
        targetH = minHugeH;
        targetW = Math.floor(targetH * r);
      }

      canvas.style.width  = targetW + "px";
      canvas.style.height = targetH + "px";

      requestAnimationFrame(panCenter);
    }

    (function enableHomePan(){
      if (!viewport) return;
      var fine = window.matchMedia && window.matchMedia("(hover:hover) and (pointer:fine)").matches;
      if (!fine) return;

      var isDown = false;
      var moved = false;
      var startX = 0, startY = 0;
      var startSL = 0, startST = 0;
      var raf = 0;
      var lastX = 0, lastY = 0;

      function applyMove(){
        raf = 0;
        if (!isDown) return;
        var dx = lastX - startX;
        var dy = lastY - startY;
        viewport.scrollLeft = startSL - dx;
        viewport.scrollTop  = startST - dy;
      }

      viewport.addEventListener("pointerdown", function(e){
        if (!isHomeActive()) return;
        if (e.pointerType && e.pointerType !== "mouse" && e.pointerType !== "pen") return;
        if (e.button != null && e.button !== 0) return;

        isDown = true;
        moved = false;

        startX = e.clientX; startY = e.clientY;
        lastX = startX; lastY = startY;

        startSL = viewport.scrollLeft;
        startST = viewport.scrollTop;

        viewport.classList.add("isGrabbing");
        viewport.setPointerCapture(e.pointerId);

        e.preventDefault();
      }, { passive:false });

      viewport.addEventListener("pointermove", function(e){
        if (!isDown) return;
        lastX = e.clientX; lastY = e.clientY;

        if (!moved){
          if (Math.abs(lastX - startX) > 3 || Math.abs(lastY - startY) > 3) moved = true;
        }
        if (!raf) raf = requestAnimationFrame(applyMove);
      });

      function endDrag(e){
        if (!isDown) return;
        isDown = false;
        viewport.classList.remove("isGrabbing");
        try{ viewport.releasePointerCapture(e.pointerId); }catch(_){}
      }

      viewport.addEventListener("pointerup", endDrag);
      viewport.addEventListener("pointercancel", endDrag);
      viewport.addEventListener("lostpointercapture", function(){
        isDown = false;
        viewport.classList.remove("isGrabbing");
      });

      viewport.addEventListener("click", function(e){
        if (!isHomeActive()) return;
        if (moved) return;

        var rect = viewport.getBoundingClientRect();
        var x = e.clientX - rect.left + viewport.scrollLeft;
        var y = e.clientY - rect.top  + viewport.scrollTop;

        viewport.scrollTo({
          left: x - viewport.clientWidth/2,
          top:  y - viewport.clientHeight/2,
          behavior:(prefersReducedMotion?"auto":"smooth")
        });
      });
    })();

    // -------------------------------------------------------
    // JS: HOME SLIDESHOW
    // -------------------------------------------------------
    var cap = $("caption");
    var prevBtn = $("prev");
    var nextBtn = $("next");

    var slideIndex = Number(localStorage.getItem("slideIndex") || 0) || 0;
    var slides = DATA.slides;
    var slideCurrentURL = "";

    function setHomeEmptyState(msg){
      if (hero) hero.removeAttribute("src");
      if (hero) hero.alt = "";
      if (cap) cap.textContent = msg || "—";
    }

    function showSlide(n){
      if (!slides.length){
        setHomeEmptyState("No slides yet (add DATA_REMOTE.slides in data.js).");
        if (prevBtn) prevBtn.disabled = true;
        if (nextBtn) nextBtn.disabled = true;
        return;
      }
      if (prevBtn) prevBtn.disabled = false;
      if (nextBtn) nextBtn.disabled = false;

      slideIndex = (n + slides.length) % slides.length;
      var s = slides[slideIndex] || {};
      var src = String(s.src || "").trim();
      var caption = String(s.caption || "").trim();

      if (!src){
        setHomeEmptyState("Slide missing src (check DATA_REMOTE.slides).");
        return;
      }

      // absolute URL for "open in new tab"
      try{ slideCurrentURL = new URL(src, location.href).toString(); }
      catch(_){ slideCurrentURL = src; }

      if (hero){
        hero.onload = function(){
          setCanvasForSlide();
        };
        hero.src = src;
        hero.alt = caption || "";
      }
      if (cap) cap.textContent = caption || "—";

      localStorage.setItem("slideIndex", String(slideIndex));
    }

    if (prevBtn) prevBtn.addEventListener("click", function(){ showSlide(slideIndex - 1); });
    if (nextBtn) nextBtn.addEventListener("click", function(){ showSlide(slideIndex + 1); });

    if (cap){
      cap.addEventListener("click", function(){
        if (!slideCurrentURL) return;
        window.open(slideCurrentURL, "_blank", "noopener");
      });
      cap.addEventListener("keydown", function(e){
        if (e.key === "Enter" || e.key === " "){
          e.preventDefault();
          cap.click();
        }
      });
    }

    window.addEventListener("resize", function(){
      setCanvasForSlide();
    });

    // -------------------------------------------------------
    // JS: CLOCK
    // -------------------------------------------------------
    var clockStamp = $("clockStamp");
    function tick(){
      if (!clockStamp) return;
      var now = new Date();
      var parts = new Intl.DateTimeFormat("en-US", {
        timeZone: "America/New_York",
        year: "numeric", month: "2-digit", day: "2-digit",
        hour: "2-digit", minute: "2-digit", second: "2-digit",
        hour12: false
      }).formatToParts(now);

      function get(t){
        for (var i=0;i<parts.length;i++){
          if (parts[i].type === t) return parts[i].value;
        }
        return "00";
      }
      clockStamp.textContent =
        get("year") + "." + get("month") + "." + get("day") +
        "T" + get("hour") + ":" + get("minute") + ":" + get("second") + ":ET";
    }
    tick();
    setInterval(tick, 1000);

    // -------------------------------------------------------
    // JS: LIST HELPERS + RENDER
    // -------------------------------------------------------
    function parseMonthYear(s){
      var str = String(s || "").trim();
      var m = str.match(/^([A-Za-z]{3,})\s+(\d{4})$/);
      if (!m) return 0;
      var mon = m[1].slice(0,3).toLowerCase();
      var year = Number(m[2]);
      var months = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};
      if (!months.hasOwnProperty(mon) || !Number.isFinite(year)) return 0;
      return new Date(year, months[mon], 1).getTime();
    }

    function authorPublisherHtml(s){
      var str = String(s || "").trim();
      var m = str.match(/^(.*)\s+\(([^)]+)\)\s*$/);
      if (!m) return esc(str);
      var author = esc(m[1].trim());
      var pub = esc(m[2].trim());
      return author + " (<em>" + pub + "</em>)";
    }

    function row1(titleHtml, metaHtml, prefixHtml){
      var metaPart = metaHtml ? ('<span class="sep"> / </span><span class="metaLine">' + metaHtml + '</span>') : "";
      var prefix = prefixHtml ? prefixHtml : "";
      return (
        '<div class="item">' +
          '<div class="pathRow">' +
            '<div class="promptLine">' +
              prefix +
              '<span class="prompt">&gt;</span>' +
              '<span class="titleCell">' + titleHtml + '</span>' +
            '</div>' +
            metaPart +
          '</div>' +
        '</div>'
      );
    }

    function render(section){
      var out = $("items-" + section);
      if (!out) return;

      var items = (DATA[section] || []).slice();
      items.sort(function(a,b){
        if (section === "factChecking") return parseMonthYear(b.date) - parseMonthYear(a.date);
        return (b.year || 0) - (a.year || 0);
      });

      if (!items.length){
        out.innerHTML = row1("No items yet.", "");
        return;
      }

      if (section === "writing"){
        var htmlW = [];
        for (var i=0;i<items.length;i++){
          var it = items[i] || {};
          var title = esc(normDashText(it.title || ""));
          var href = it.url ? String(it.url) : "";
          var titleHtml = href
            ? ('<a href="' + esc(href) + '" target="_blank" rel="noopener">' + title + '</a>')
            : title;

          var pub = it.outlet ? ("<em>" + esc(it.outlet) + "</em>") : "";
          var year = it.year ? esc(it.year) : "";
          var metaHtml = [pub, year].filter(Boolean).join(" / ");
          htmlW.push(row1(titleHtml, metaHtml));
        }
        out.innerHTML = htmlW.join("");
        return;
      }

      if (section === "research"){
        var htmlR = [];
        for (var j=0;j<items.length;j++){
          var it2 = items[j] || {};
          var raw = esc(normDashText(it2.title || ""));
          var inner = it2.italic ? ("<em>" + raw + "</em>") : raw;
          var href2 = it2.url ? String(it2.url) : "";
          var titleHtml2 = href2
            ? ('<a href="' + esc(href2) + '" target="_blank" rel="noopener">' + inner + '</a>')
            : inner;

          var ap = it2.outlet ? authorPublisherHtml(it2.outlet) : "";
          var year2 = it2.year ? esc(it2.year) : "";
          var metaHtml2 = [ap, year2].filter(Boolean).join(" / ");
          htmlR.push(row1(titleHtml2, metaHtml2));
        }
        out.innerHTML = htmlR.join("");
        return;
      }

      // factChecking
      var htmlF = [];
      for (var k=0;k<items.length;k++){
        var it3 = items[k] || {};
        var titleQuoted = '<span class="q">' + esc(normDashText(it3.title || "")) + '</span>';
        var href3 = it3.url ? String(it3.url) : "";
        var titleHtml3 = href3
          ? ('<a href="' + esc(href3) + '" target="_blank" rel="noopener">' + titleQuoted + '</a>')
          : titleQuoted;

        var author = esc(it3.author || "");
        var pub3 = it3.publication ? ("<em>" + esc(it3.publication) + "</em>") : "";
        var ap3 = (author && pub3) ? (author + " (" + pub3 + ")") : (author || (pub3 ? ("(" + pub3 + ")") : ""));
        var date3 = esc(it3.date || "");
        var metaHtml3 = [ap3, date3].filter(Boolean).join(" / ");
        htmlF.push(row1(titleHtml3, metaHtml3));
      }
      out.innerHTML = htmlF.join("");
    }

    // -------------------------------------------------------
    // JS: BLOG (IN-WINDOW)
    // -------------------------------------------------------
    var itemsNotes   = $("items-notes");

    var blogHomeBtn   = $("blogHome");
    var blogCrumbTail = $("blogCrumbTail");
    var blogPrevBtn   = $("blogPrev");
    var blogNextBtn   = $("blogNext");
    var blogListBtn   = $("blogList");

    var blogSortDateBtn = $("blogSortDate");
    var blogSortTypeBtn = $("blogSortType");

    var blogOpenBtn   = $("blogOpen2");

    var blogBody      = $("blogBody");
    var blogSortEl    = $("blogSort");
    var blogListWrap  = $("blogListWrap");
var blogView      = $("blogView");
    var blogTitle     = $("blogTitle");
    var blogEntryMeta = $("blogEntryMeta");
    var blogContent   = $("blogContent");
    var blogCaption2  = $("blogCaption");

    var notesKeyToIndex = new Map();
    var suppressHashReopen = false;

    var blogOrder = [];
    var blogPos = -1; // position within blogOrder
    var blogListScrollTop = 0;

    var blogSortMode = (localStorage.getItem("blogSortMode") || "date"); // "date" | "type"
    if (blogSortMode !== "type") blogSortMode = "date";
    var blogSortDirDate = Number(localStorage.getItem("blogSortDirDate") || "1"); //  1=newest→oldest, -1=oldest→newest
    var blogSortDirType = Number(localStorage.getItem("blogSortDirType") || "1"); //  1=A→Z, -1=Z→A

    var blogCurrentURL = "";

    function normalizeDashSpacing(s){
  s = String(s == null ? "" : s);
  // En-dash is used as a separator in titles; normalize it with spaces.
  s = s.replace(/\s*–\s*/g, " – ");
  // Hyphen-minus: only normalize when it's already acting as a separator (has whitespace on either side).
  s = s.replace(/\s-\s*/g, " - ");
  return s;
}

function parseISODateStrict(s){
      var str = String(s || "").trim();
      var m = str.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if (!m) return 0;
      var y = Number(m[1]), mo = Number(m[2]), d = Number(m[3]);
      if (!Number.isFinite(y) || !Number.isFinite(mo) || !Number.isFinite(d)) return 0;
      if (mo < 1 || mo > 12 || d < 1 || d > 31) return 0;
      return Date.UTC(y, mo - 1, d);
    }

    function typeLower(n){
      return String((n && n.type) ? n.type : "").trim().toLowerCase() || "entry";
    }


function typeLabel(n){
  var raw = (n && n.type) ? String(n.type).trim() : "";
  if (raw) return raw;
  // fallback to normalized key
  var k = noteTypeKey(n || {});
  if (!k) return "";
  return k.charAt(0).toUpperCase() + k.slice(1);
}

    function noteTS(n){
      var t = parseISODateStrict((n && n.date) ? n.date : "");
      if (t) return t;
      var d = Date.parse(String((n && n.date) ? n.date : ""));
      return Number.isFinite(d) ? d : 0;
    }

    function buildBlogOrder(){
      var notes = Array.isArray(DATA.notes) ? DATA.notes : [];
      var ids = [];
      for (var k=0;k<notes.length;k++) ids.push(k);

      var dirDate = (blogSortDirDate === -1 ? -1 : 1); // normalize
      var dirType = (blogSortDirType === -1 ? -1 : 1);

      if (blogSortMode === "type"){
        // group by type (toggleable), then date within type (toggleable)
        ids.sort(function(a,b){
          var ka = noteTypeKey(notes[a] || {});
          var kb = noteTypeKey(notes[b] || {});
          if (ka < kb) return -1 * dirType;
          if (ka > kb) return  1 * dirType;

          var ta = noteTS(notes[a] || {});
          var tb = noteTS(notes[b] || {});
          if (tb !== ta) return (tb - ta) * dirDate;
          return a - b;
        });
      } else {
        // date (toggleable)
        ids.sort(function(a,b){
          var ta = noteTS(notes[a] || {});
          var tb = noteTS(notes[b] || {});
          if (tb !== ta) return (tb - ta) * dirDate;
          return a - b;
        });
      }

      blogOrder = ids;
      updateBlogSortUI();
    }

    function setNavEnabled(btn, on){
      if (!btn) return;
      btn.disabled = !on;
      btn.classList.toggle("isDim", !on);
    }

    function setBlogMode(mode){
      var isList = (mode === "list");
      if (blogListWrap) blogListWrap.hidden = !isList;
      if (blogView) blogView.hidden = isList;
      if (blogSortEl) blogSortEl.hidden = !isList;

      if (isList){
        if (blogCrumbTail) blogCrumbTail.textContent = "";
        blogPos = -1;
        if (blogPrevBtn) blogPrevBtn.hidden = true;
        if (blogNextBtn) blogNextBtn.hidden = true;
        if (blogListBtn) blogListBtn.hidden = true;
        setNavEnabled(blogOpenBtn, false);
      } else {
        if (blogPrevBtn) blogPrevBtn.hidden = false;
        if (blogNextBtn) blogNextBtn.hidden = false;
        if (blogListBtn) blogListBtn.hidden = false;
        setNavEnabled(blogListBtn, true);
        setNavEnabled(blogPrevBtn, blogPos > 0);
        setNavEnabled(blogNextBtn, blogPos >= 0 && blogPos < blogOrder.length - 1);
        setNavEnabled(blogOpenBtn, !!blogCurrentURL);
      }
    }

    function updateBlogSortUI(){
      var dateActive = (blogSortMode === "date");
      var typeActive = (blogSortMode === "type");

      if (blogSortDateBtn){
        blogSortDateBtn.classList.toggle("isOn", dateActive);
        blogSortDateBtn.title = "Sort by date (" + (blogSortDirDate === 1 ? "newest first" : "oldest first") + ")";
        blogSortDateBtn.setAttribute("aria-label", blogSortDateBtn.title);
      }
      if (blogSortTypeBtn){
        blogSortTypeBtn.classList.toggle("isOn", typeActive);
        blogSortTypeBtn.title = "Sort by type (" + (blogSortDirType === 1 ? "A→Z" : "Z→A") + ")";
        blogSortTypeBtn.setAttribute("aria-label", blogSortTypeBtn.title);
      }
    }

    function slugify(s){
      return String(s || "")
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "")
        .slice(0, 60);
    }

    function noteKey(n, idx){
      if (n && n.id) return String(n.id).trim();
      if (n && n.file) return slugify(String(n.file));
      var base = (n && n.date ? String(n.date) : "") + "-" + (n && n.title ? String(n.title) : "");
      var s = slugify(base);
      return s || String(idx);
    }

    function noteKeyFromHash(){
      var m = String(location.hash || "").match(/^#\/notes\/([^\/?#]+)\b/);
      return m ? decodeURIComponent(m[1]) : "";
    }

    function buildNotesKeyIndex(){
      notesKeyToIndex.clear();
      var notes = Array.isArray(DATA.notes) ? DATA.notes : [];
      for (var i=0;i<notes.length;i++){
        notesKeyToIndex.set(noteKey(notes[i] || {}, i), i);
      }
    }

    function noteTypeKey(n){
      var t = String((n && n.type) ? n.type : "").trim().toLowerCase();
      if (!t) return "other";
      if (t === "footnotes") t = "footnote";
      if (t === "photos") t = "photo";
      if (t === "images") t = "image";
      if (t === "article" || t === "footnote") return "article";
      return t;
    }

    function ledClassForType(n){
      var k = noteTypeKey(n);
      if (k === "zine")  return "led-zine";
      if (k === "video") return "led-video";
      if (k === "photo") return "led-photo";
      if (k === "pdf")   return "led-pdf";
      if (k === "article") return "led-article";
      return "led-other";
    }

    function fmtNoteMeta(n){
      var parts = [];
      var type = String((n && n.type) ? n.type : "").trim();
      var date = String((n && n.date) ? n.date : "").trim();
      if (type) parts.push(type);
      if (date) parts.push(date);
      return parts.join(" / ") || "—";
    }

    /* Thorough sizing: set per-type max heights based on real available space */
    function fitBlogMedia(){
      if (!blogBody || !blogView || blogView.hidden) return;

      var bodyH = blogBody.clientHeight || 0;
      if (!bodyH) return;

      var hdrH = 0;
      if (blogTitle && blogTitle.parentElement) hdrH = blogTitle.parentElement.getBoundingClientRect().height;
      var metaH = blogEntryMeta ? blogEntryMeta.getBoundingClientRect().height : 0;
      var capH  = (blogCaption2 && !blogCaption2.hidden) ? blogCaption2.getBoundingClientRect().height : 0;

      // breathing room between blocks (tight, because you want taller reading area)
      var padImg = 22;
      var padPdf = 16;
      var padVid = 20;

      var imgMax = Math.max(220, Math.floor(bodyH - hdrH - metaH - capH - padImg));
      var pdfMax = Math.max(260, Math.floor(bodyH - hdrH - metaH - capH - padPdf)); // slightly taller
      var vidMax = Math.max(220, Math.floor(bodyH - hdrH - metaH - capH - padVid));

      var panel = document.getElementById("p-notes");
      if (!panel) return;

      panel.style.setProperty("--blogImgMaxH", imgMax + "px");
      panel.style.setProperty("--blogPdfMaxH", pdfMax + "px");
      panel.style.setProperty("--blogVidMaxH", vidMax + "px");
    }

    function clearBlogViewClasses(){
      if (!blogView) return;
      blogView.classList.remove("isImg","isPdf","isVideo","isHtml","isOther");
    }

    function renderBlogEntryAt(pos){
      blogCurrentURL = "";
      var notes = Array.isArray(DATA.notes) ? DATA.notes : [];
      if (!blogOrder.length) buildBlogOrder();
      if (pos < 0 || pos >= blogOrder.length) return;

      blogPos = pos;
      var idx = blogOrder[pos];
      var n = notes[idx] || {};

      // header path: blog / type / date (no slug)
      var t = typeLower(n);
      var d = String((n && n.date) ? n.date : "").trim();
      if (blogCrumbTail){
        blogCrumbTail.textContent = " / " + t + (d ? (" / " + d) : "");
      }
      if (blogEntryMeta){
        blogEntryMeta.textContent = (t ? t : "—") + (d ? (" / " + d) : "");
      }

      // title below rule
      var ttl = String((n && n.title) ? n.title : "Untitled").trim() || "Untitled";
      if (blogTitle) blogTitle.textContent = "> " + ttl;

      // caption (window-blended strip)
      var cap = String((n && n.caption) ? n.caption : "").trim();
      if (blogCaption2){
        blogCaption2.textContent = cap;
        blogCaption2.hidden = !cap;
      }

      // content
      if (blogContent){
        blogContent.innerHTML = "";
        clearBlogViewClasses();

        var yt = String((n && n.youtube) ? n.youtube : "").trim();
        var file = "";

        if (yt){
          yt = yt.replace(/[^a-zA-Z0-9_-]/g, "");
          file = "https://www.youtube-nocookie.com/embed/" + yt + "?rel=0";
        } else {
          file = String((n && n.file) ? n.file : "").trim();
        }

        if (!file){
          if (blogView) blogView.classList.add("isOther");
          blogContent.innerHTML = "<p>(No file attached.)</p>";
          setTimeout(fitBlogMedia, 0);
        } else {
          var fUrl = file;
          try{ fUrl = new URL(file, location.href).toString(); }
          catch(_){ fUrl = encodeURI(file); }

          var lower = fUrl.toLowerCase();

          blogCurrentURL = fUrl;
          var extm = lower.match(/\.([a-z0-9]+)(?:\?|#|$)/i);
          var ext = extm ? extm[1] : "";

          if (yt){
            if (blogView) blogView.classList.add("isVideo");
            blogContent.innerHTML =
              '<div class="blogMediaFrame"><iframe src="' + esc(fUrl) + '" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin" title="' + esc(ttl) + '"></iframe></div>';
            setTimeout(fitBlogMedia, 0);
          } else if (ext === "pdf"){
            // PDFs: hint the browser viewer to fit page width (reduces side whitespace)
            if (blogView) blogView.classList.add("isPdf");

            var pdfUrl = fUrl;
            if (pdfUrl.indexOf("#") === -1){
              pdfUrl = pdfUrl + "#view=FitH";
            } else if (pdfUrl.indexOf("view=") === -1){
              pdfUrl = pdfUrl + (pdfUrl.endsWith("#") || pdfUrl.endsWith("&") ? "" : "&") + "view=FitH";
            }

            blogContent.innerHTML =
              '<div class="blogMediaFrame"><embed src="' + esc(pdfUrl) + '" type="application/pdf" /></div>';
            setTimeout(fitBlogMedia, 0);
          } else if (ext === "html" || ext === "htm"){
            if (blogView) blogView.classList.add("isHtml");
            // Render HTML in an iframe so it can scroll naturally and fill the viewer.
            blogContent.innerHTML =
              '<div class="blogMediaFrame isHtmlFrame"><iframe src="' + esc(fUrl) + '" loading="lazy" referrerpolicy="strict-origin-when-cross-origin" title="' + esc(ttl) + '"></iframe></div>';
            setTimeout(fitBlogMedia, 0);
          } else if (/(png|jpe?g|gif|webp|bmp|svg)/i.test(ext)){
            if (blogView) blogView.classList.add("isImg");
            blogContent.innerHTML = '<div class="blogMediaFrame isImgFrame"><img src="' + esc(fUrl) + '" alt="' + esc(ttl) + '" loading="lazy" decoding="async" /></div>';
            var img = blogContent.querySelector("img");
            if (img){
              img.style.cursor = "pointer";
              img.title = "Open in new tab";
              img.addEventListener("click", function(e){
                e.preventDefault();
                e.stopPropagation();
                var u = blogCurrentURL || fUrl;
                if (u) window.open(u, "_blank", "noopener");
              });
              img.addEventListener("load", fitBlogMedia, { once:true });
              img.addEventListener("error", fitBlogMedia, { once:true });
            } else {
              setTimeout(fitBlogMedia, 0);
            }
          } else if (/(mp4|webm|ogg)/i.test(ext)){
            if (blogView) blogView.classList.add("isOther");
            blogContent.innerHTML = '<div class="blogMediaFrame"><video controls playsinline preload="metadata" src="' + esc(fUrl) + '"></video></div>';
            var vid = blogContent.querySelector("video");
            if (vid){
              vid.addEventListener("loadedmetadata", fitBlogMedia, { once:true });
            } else {
              setTimeout(fitBlogMedia, 0);
            }
          } else if (noteTypeKey(n) === "video"){
            // Non-YouTube, non-file-extension video embeds (Vimeo, Archive, player pages, etc.)
            // If it's not a direct video file, render as an iframe player.
            if (blogView) blogView.classList.add("isVideo");
            blogContent.innerHTML =
              '<div class="blogMediaFrame"><iframe src="' + esc(fUrl) + '" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin" title="' + esc(ttl) + '"></iframe></div>';
            setTimeout(fitBlogMedia, 0);
          } else {
            if (blogView) blogView.classList.add("isOther");
            blogContent.innerHTML = '<p><a href="' + esc(fUrl) + '" target="_blank" rel="noopener">open file</a></p>';
            setTimeout(fitBlogMedia, 0);
          }
        }
      }

      /* entry view: no list scroll */
      setBlogMode("entry");
      setTimeout(fitBlogMedia, 0);
    }

    function openBlogByIdx(idx){
      if (blogListWrap) blogListScrollTop = blogListWrap.scrollTop;

      if (!blogOrder.length) buildBlogOrder();
      var pos = -1;
      for (var k=0;k<blogOrder.length;k++){
        if (blogOrder[k] === idx){ pos = k; break; }
      }
      if (pos < 0) return;
      renderBlogEntryAt(pos);
    }

    function renderNotesList(){
      if (!itemsNotes) return;
      buildNotesKeyIndex();

      var notes = Array.isArray(DATA.notes) ? DATA.notes : [];
      buildBlogOrder();

      if (!blogOrder.length){
        itemsNotes.innerHTML = '<div class="item"><div class="pathRow"><span class="noteLedCell"><span class="led led-other" aria-hidden="true"></span></span><span class="prompt">&gt;</span><span class="metaLine">No entries yet.</span></div></div>';
        return;
      }

      var out = [];
      for (var j=0;j<blogOrder.length;j++){
        var idx = blogOrder[j];
        var n = notes[idx] || {};
        var key = noteKey(n, idx);

        var title = esc(String(n.title || "Untitled").trim() || "Untitled");
        var typeTxt = esc(typeLabel(n) || "");
        var dateTxt = esc(String((n && n.date) ? n.date : "").trim());

        var href = "#/notes/" + encodeURIComponent(key);
        var ledCls = esc(ledClassForType(n));

        out.push(
          '<div class="item noteItem">' +
            '<div class="pathRow">' +
              '<span class="noteLedCell"><span class="led ' + ledCls + '" aria-hidden="true"></span></span>' +
              '<span class="prompt">&gt;</span>' +
              '<a class="titleCell" href="' + esc(href) + '">' + title + '</a>' +
              (typeTxt ? ('<span class="sep"> / </span><span class="metaLine">' + typeTxt + '</span>') : '') +
              (dateTxt ? ('<span class="sep"> / </span><span class="metaLine">' + dateTxt + '</span>') : '') +
            '</div>' +
          '</div>'
        );
      }
      itemsNotes.innerHTML = out.join("");
    }
    function showBlogList(){
      renderNotesList();
      if (blogListWrap) blogListWrap.scrollTop = blogListScrollTop;
      setBlogMode("list");
    }

    function refreshNotes(){
      renderNotesList();
      if (suppressHashReopen) return;

      var key = noteKeyFromHash();
      if (!key){
        showBlogList();
        return;
      }

      buildNotesKeyIndex();
      var idx = notesKeyToIndex.has(key) ? notesKeyToIndex.get(key) : -1;

      if (idx >= 0){
        openBlogByIdx(idx);
        return;
      }

      showBlogList();
    }

    function gotoNoteDelta(delta){
      if (!blogOrder.length) buildBlogOrder();
      if (blogPos < 0) return;

      var newPos = blogPos + delta;
      if (newPos < 0 || newPos >= blogOrder.length) return;

      var notes = Array.isArray(DATA.notes) ? DATA.notes : [];
      var idx = blogOrder[newPos];
      var key = noteKey(notes[idx] || {}, idx);

      suppressHashReopen = true;
      location.hash = "#/notes/" + encodeURIComponent(key);
      setTimeout(function(){
        suppressHashReopen = false;
        refreshNotes();
      }, 0);
    }

    
    // Keyboard shortcuts (Blog)
    // - Entry mode only (prevents hijacking page navigation)
    //   ← / → : prev / next
    //   Esc   : back to list
    //   O     : open in new tab
    document.addEventListener("keydown", function(e){
      if (e.defaultPrevented) return;

      var t = e.target;
      var tag = t && t.tagName ? String(t.tagName).toUpperCase() : "";
      if (tag === "INPUT" || tag === "TEXTAREA" || (t && t.isContentEditable)) return;

      var h = String(location.hash || "");
      if (h.indexOf("#/notes") !== 0) return;

      // Only when the Blog panel is actually visible
      var p = document.getElementById("p-notes");
      if (!p || p.hidden) return;

      var inEntry = blogView && !blogView.hidden;

      if (e.key === "Escape"){
        if (inEntry){
          if (blogListBtn && !blogListBtn.disabled) blogListBtn.click();
          e.preventDefault();
        }
        return;
      }

      if (!inEntry) return;

      if (e.key === "ArrowLeft"){
        gotoNoteDelta(-1);
        e.preventDefault();
        return;
      }
      if (e.key === "ArrowRight"){
        gotoNoteDelta(1);
        e.preventDefault();
        return;
      }
      if (e.key === "o" || e.key === "O"){
        if (blogOpenBtn && !blogOpenBtn.disabled) blogOpenBtn.click();
        e.preventDefault();
        return;
      }
    });
// Blog header controls
    if (blogHomeBtn){
      blogHomeBtn.addEventListener("click", function(){
        suppressHashReopen = true;
        location.hash = "#/notes";
        setTimeout(function(){
          suppressHashReopen = false;
          refreshNotes();
        }, 0);
      });
    }
    if (blogListBtn){
      blogListBtn.addEventListener("click", function(){
        if (blogListBtn.disabled) return;
        suppressHashReopen = true;
        location.hash = "#/notes";
        setTimeout(function(){
          suppressHashReopen = false;
          refreshNotes();
        }, 0);
      });
    }

    if (blogSortDateBtn){
      blogSortDateBtn.addEventListener("click", function(){
        if (blogSortMode !== "type"){
          blogSortDirDate = (blogSortDirDate === -1 ? 1 : -1);
          localStorage.setItem("blogSortDirDate", String(blogSortDirDate));
        } else {
          blogSortMode = "date";
          localStorage.setItem("blogSortMode", blogSortMode);
        }
        blogListScrollTop = 0;
        refreshNotes();
      });
    }
    if (blogSortTypeBtn){
      blogSortTypeBtn.addEventListener("click", function(){
        if (blogSortMode === "type"){
          blogSortDirType = (blogSortDirType === -1 ? 1 : -1);
          localStorage.setItem("blogSortDirType", String(blogSortDirType));
        } else {
          blogSortMode = "type";
          localStorage.setItem("blogSortMode", blogSortMode);
        }
        blogListScrollTop = 0;
        refreshNotes();
      });
    }

    if (blogOpenBtn){
      blogOpenBtn.addEventListener("click", function(){
        if (blogOpenBtn.disabled) return;
        if (!blogCurrentURL) return;
        window.open(blogCurrentURL, "_blank", "noopener");
      });
    }
    if (blogPrevBtn){
      blogPrevBtn.addEventListener("click", function(){
        if (blogPrevBtn.disabled) return;
        gotoNoteDelta(-1);
      });
    }
    if (blogNextBtn){
      blogNextBtn.addEventListener("click", function(){
        if (blogNextBtn.disabled) return;
        gotoNoteDelta(1);
      });
    }

    window.addEventListener("resize", function(){
      fitBlogMedia();
    });

    if (window.ResizeObserver && blogBody){
      try{
        var ro = new ResizeObserver(function(){ fitBlogMedia(); });
        ro.observe(blogBody);
      }catch(_){ }
    }

    // -------------------------------------------------------
    // JS: TIMEQUOTES
    // -------------------------------------------------------
    var timeDialog = $("timeDialog");
    var timePrev = $("timePrev");
    var timeNext = $("timeNext");
    var timeClose = $("timeClose");
    var timeQuoteText = $("timeQuoteText");
    var timeQuoteMeta = $("timeQuoteMeta");
    var timeIdx = $("timeIdx");
    var clockBtn = $("clockBtn");

    var qi = Number(localStorage.getItem("timeQuoteIndex") || 0) || 0;

    function pad2(n){ return (n < 10 ? ("0" + n) : String(n)); }

    function renderTimeQuote(){
      var quotes = Array.isArray(DATA.timeQuotes) ? DATA.timeQuotes : [];
      var total = quotes.length;

      if (!total){
        if (timeQuoteText) timeQuoteText.textContent = "> (add quote here)";
        if (timeQuoteMeta) timeQuoteMeta.textContent  = ">> (work / author)";
        if (timeIdx) timeIdx.textContent = "00/00";
        return;
      }

      qi = ((qi % total) + total) % total;
      var q = quotes[qi] || {};
      var text = String(q.quote || "").trim();
      var work = String(q.work || "").trim();
      var author = String(q.author || "").trim();

      if (timeQuoteText) timeQuoteText.textContent = "> " + (text || "(add quote here)");

      var metaParts = [];
      if (work) metaParts.push(work);
      if (author) metaParts.push(author);
      if (timeQuoteMeta) timeQuoteMeta.textContent = ">> " + (metaParts.join(" / ") || "(work / author)");

      if (timeIdx) timeIdx.textContent = pad2(qi + 1) + "/" + pad2(total);

      localStorage.setItem("timeQuoteIndex", String(qi));
    }

    function openTimeDialog(){
      if (!timeDialog) return;
      renderTimeQuote();
      if (typeof timeDialog.showModal === "function") timeDialog.showModal();
      else timeDialog.setAttribute("open", "open");
      setBodyModalOpen(true);
    }

    function closeTimeDialog(){
      if (!timeDialog) return;
      if (typeof timeDialog.close === "function") timeDialog.close();
      else timeDialog.removeAttribute("open");
      setBodyModalOpen(false);
    }

    if (timePrev){ timePrev.addEventListener("click", function(){ qi -= 1; renderTimeQuote(); }); }
    if (timeNext){ timeNext.addEventListener("click", function(){ qi += 1; renderTimeQuote(); }); }
    if (timeClose){ timeClose.addEventListener("click", closeTimeDialog); }

    if (timeDialog){
      timeDialog.addEventListener("click", function(e){
        if (e.target === timeDialog) closeTimeDialog();
      });
    }

    window.addEventListener("keydown", function(e){
      if (!timeDialog || !timeDialog.hasAttribute("open")) return;
      if (e.key === "Escape") closeTimeDialog();
      if (e.key === "ArrowLeft"){ qi -= 1; renderTimeQuote(); }
      if (e.key === "ArrowRight"){ qi += 1; renderTimeQuote(); }
    });

    if (clockBtn){
      clockBtn.addEventListener(isCoarsePointer() ? "click" : "dblclick", function(e){
        e.preventDefault();
        openTimeDialog();
      });
    }

    // -------------------------------------------------------
    // JS: ABOUT (nameplate modal)
    // -------------------------------------------------------
    var aboutDialog = $("aboutDialog");
    var aboutPrev = $("aboutPrev");
    var aboutNext = $("aboutNext");
    var aboutClose = $("aboutClose");
    var aboutText = $("aboutText");
    var aboutTitle = $("aboutTitle");

    var aboutSlides = Array.isArray(DATA.aboutSlides) ? DATA.aboutSlides : [];
    var ai = Number(localStorage.getItem("aboutSlideIndex") || 0) || 0;

    function fitAboutAscii(){
      if (!aboutText) return;

      var pre = aboutText.querySelector("pre.ascii");
      if (!pre) return;

      if (!pre.dataset.baseFont){
        var base = parseFloat(getComputedStyle(pre).fontSize) || 8;
        pre.dataset.baseFont = String(base);
      }

      var baseFont = parseFloat(pre.dataset.baseFont) || 8;
      pre.style.fontSize = baseFont + "px";

      var boxW = aboutText.clientWidth || 0;
      var contentW = pre.scrollWidth || 0;
      if (!boxW || !contentW) return;

      var scale = Math.min(1, (boxW - 2) / contentW);
      var newFont = Math.max(3.5, baseFont * scale);

      var boxH = aboutText.clientHeight || 0;
      var contentH = pre.scrollHeight || 0;
      if (boxH && contentH){
        var scaleH = Math.min(1, (boxH - 2) / contentH);
        newFont = Math.max(3.5, Math.min(newFont, baseFont * scaleH));
      }

      pre.style.fontSize = newFont.toFixed(2) + "px";
      pre.style.lineHeight = "1.0";
    }

    function renderAboutSlide(){
      var total = aboutSlides.length;

      if (!total){
        if (aboutTitle) aboutTitle.textContent = "About";
        if (aboutText) aboutText.textContent = "> (add DATA_REMOTE.aboutSlides in data.js)";
        return;
      }

      ai = ((ai % total) + total) % total;
      var s = aboutSlides[ai] || {};

      var title = String(s.title || "").trim();

      var hasHTML = (s.html != null && String(s.html).trim() !== "");
      var rawText = String(s.text || s.body || "").trim();
      var rawHTML = hasHTML ? String(s.html).trim() : "";

      if (aboutTitle) aboutTitle.textContent = title || "About";

      if (aboutText){
        if (hasHTML){
          aboutText.innerHTML = rawHTML;
        } else {
          aboutText.textContent = "> " + (rawText || "(empty)");
        }
      }

      localStorage.setItem("aboutSlideIndex", String(ai));
      setTimeout(fitAboutAscii, 0);
    }

    function openAboutDialog(){
      if (!aboutDialog) return;
      aboutSlides = Array.isArray(DATA.aboutSlides) ? DATA.aboutSlides : [];

      // Always start on "Who am I?" (fallback to first slide)
      var target = -1;
      for (var i=0;i<aboutSlides.length;i++){
        var t = String((aboutSlides[i]||{}).title || "").trim().toLowerCase();
        if (t === "who am i?" || t === "who am i"){ target = i; break; }
      }
      ai = (target >= 0) ? target : 0;
      localStorage.setItem("aboutSlideIndex", String(ai));

      renderAboutSlide();

      try{
        if (!aboutDialog.open){
          if (typeof aboutDialog.showModal === "function") aboutDialog.showModal();
          else aboutDialog.setAttribute("open","open");
        }
      }catch(_){
        aboutDialog.setAttribute("open","open");
      }
      setBodyModalOpen(true);
    }

    function closeAboutDialog(){
      if (!aboutDialog) return;
      if (typeof aboutDialog.close === "function") aboutDialog.close();
      else aboutDialog.removeAttribute("open");
      setBodyModalOpen(false);
    }

    if (aboutPrev) aboutPrev.addEventListener("click", function(){ ai -= 1; renderAboutSlide(); });
    if (aboutNext) aboutNext.addEventListener("click", function(){ ai += 1; renderAboutSlide(); });
    if (aboutClose) aboutClose.addEventListener("click", closeAboutDialog);

    if (aboutDialog){
      aboutDialog.addEventListener("click", function(e){
        if (e.target === aboutDialog) closeAboutDialog();
      });
    }

    window.addEventListener("resize", function(){
      if (aboutDialog && aboutDialog.open) fitAboutAscii();
    });

    window.addEventListener("keydown", function(e){
      if (!aboutDialog || !aboutDialog.hasAttribute("open")) return;
      if (e.key === "Escape"){ e.preventDefault(); closeAboutDialog(); }
      if (e.key === "ArrowLeft"){ e.preventDefault(); ai -= 1; renderAboutSlide(); }
      if (e.key === "ArrowRight"){ e.preventDefault(); ai += 1; renderAboutSlide(); }
    });

    // -------------------------------------------------------
    // JS: ROUTER
    // -------------------------------------------------------
    var panels = {
      home: $("p-home"),
      writing: $("p-writing"),
      research: $("p-research"),
      notes: $("p-notes"),
      contact: $("p-contact")
    };
    var links = {
      home: $("linkHomeTop"),
      writing: $("linkWriting"),
      research: $("linkResearch"),
      notes: $("linkNotes"),
      contact: $("linkContact")
    };

    function normalizeRoute(hash){
      var raw = String(hash || "");
      var m = raw.match(/^#\/(home|writing|research|notes|contact)\b/);
      return m ? m[1] : "home";
    }

    function setActive(key){
      Object.keys(panels).forEach(function(k){
        if (panels[k]) panels[k].classList.toggle("isActive", k === key);
      });
      Object.keys(links).forEach(function(k){
        if (links[k]) links[k].classList.toggle("isActive", k === key);
      });

      if (key === "home") requestAnimationFrame(panCenter);
      if (key === "notes") requestAnimationFrame(function(){
        refreshNotes();
        setTimeout(fitBlogMedia, 0);
      });
    }

    document.addEventListener("click", function(e){
      var a = e.target.closest("a[data-route]");
      if (!a) return;
      e.preventDefault();
      var key = a.dataset.route || "home";
      location.hash = "#/" + key;
    });

    // Home nameplate opens About modal on DOUBLE-CLICK
    var homeNameplate = $("linkHomeTop");
    if (homeNameplate){
      homeNameplate.addEventListener("dblclick", function(e){
        e.preventDefault();
        e.stopPropagation();
        location.hash = "#/home";
        setTimeout(openAboutDialog, 0);
      });

      // Mobile: single tap opens About when already on Home
      homeNameplate.addEventListener("click", function(e){
        if (!isCoarsePointer()) return;
        var r = normalizeRoute(location.hash);
        if (r !== "home") return;
        e.preventDefault();
        e.stopPropagation();
        setTimeout(openAboutDialog, 0);
      });
    }

    window.addEventListener("hashchange", function(){
      var r = normalizeRoute(location.hash);
      setActive(r);
      if (r === "notes"){
        refreshNotes();
        setTimeout(fitBlogMedia, 0);
      }
    });

    // -------------------------------------------------------
    // JS: INIT
    // -------------------------------------------------------
    if (!location.hash) location.hash = "#/home";
    setActive(normalizeRoute(location.hash));

    render("writing");
    render("research");
    render("factChecking");

    refreshNotes();

    showSlide(slideIndex);
    requestAnimationFrame(function(){
      setCanvasForSlide();
      panCenter();
    });
  }

  // Load data.js ONCE, then boot.
  var DATA_VERSION = ""; // set to e.g. "2026-02-23" to force-refresh data.js cache
  var src = "data.js" + (DATA_VERSION ? ("?v=" + encodeURIComponent(DATA_VERSION)) : "");

  var s = document.createElement("script");
  s.src = src;
  s.async = true;
  s.onload = function(){ boot(); };
  s.onerror = function(){
    console.warn("data.js failed to load — booting with empty DATA_REMOTE.");
    boot();
  };
  document.head.appendChild(s);
})();
</script>

</body>
</html>
